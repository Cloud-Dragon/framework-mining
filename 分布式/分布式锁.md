# 分布式锁



什么是分布式锁

实现分布式锁的注意事项，

分布式环境为锁的实现增加了不少难度，在实现上我们需要关注以下问题

- 异常未释放
- 设置值与设置超时时间不是原子操作
- 锁提前过期
- 可重入





## redis实现分布式锁

### 思路



- 加锁

每个锁作为一个key，各个请求通过抢占的方式未这个key赋值，赋值成功即代表成功获取锁，未获取到的请求保持轮询知道获取锁或者超时为止。使用 `SETNX key value` 

- 解锁

主动释放

使用完成之后，主动调用删除key，完成锁的释放

超时释放

获取锁之后由于宕机，网络等意外情况，导致锁无法主动释放，后面的请求就无法获取到这个锁，因而设置超时时间，异常自动释放



加锁



### redission实现





## zookeeper实现



## 总结

对比

zookeeper  公平锁





|      |  redis   | zookeeper |
| :--- | :------: | :-------: |
|      | 非公平锁 |  公平锁   |
| abc  |   bcd    |    cde    |
| abc  |   bcd    |    cde    |