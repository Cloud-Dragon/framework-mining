



[TOC]





分布式环境中存在的问题



通信异常

节点之间网络出现异常无法正常访问

网络分区

一部分节点可以连通，

三态



节点故障





## 分布式事务

### ACID原则

即（`Atomicity`原子性，`Consistency`一致性，`Isolation`隔离性，`Durability`持久性）是事务的特点，具有强一致性，一般用于单机事务，比如数据库事务。

#### 原子性(A)

#### 一致性(C)

#### 隔离性(I)



#### 持久性(D)

### CAP

（`Consistency`一致性，`Availability`可用性，`Partition tolerance`分区容错性）理论是当前分布式系统公认的理论，亦即一个分布式系统不可能同时满足这三个特性，只能三求其二。对于分布式系统，`P`是基本要求，如果没有`P`就不是分布式系统了，所以一般都是在满足`P`的情况下，在`C`和`A`之间寻求平衡。

在互联网产品中几乎找不到单机应用，一般会通过数据副本实现灾备，数据分片实现横向扩展。

#### 一致性(C)

为了提高可用性，通常会对数据进行灾备处理，多个数据副本之间需保证数据一致，即为一致性

#### 可用性(A)

可用性即持续提供服务的能力，当某些机器出现故障时，仍然能够对外提供服务。通常通过SLA(Service-Level Agreement,服务等级协议)来衡量。通常考察服务**响应时间**以及**成功率**。

#### 分区容错性(P)

当部分节点因为网络等原因，导致部分节点被隔离，即子网络之间网络不连通但是子网络内部是正常的情况，形成网络分区，这种情况发生会导致数据不一致出现一些不可控的影响，危害大于可用性和一致性带来的影响，因而需要保证分区容错。一个节点的话不会发生网络分区，但是会失去扩展性。



对比

|  CAP  |                             说明                             |
| :---: | :----------------------------------------------------------: |
| 放弃P | 如果希望能够避免系统出现分区容错性问题，一种较为简单的做法是将所有的数据（或者仅仅是哪些与事务相关的数据）都放在**一个分布式节点上**。这样做虽然无法100%保证系统不会出错，但至少不会碰到由于网络分区带来的负面影响。但同时需要注意的是，放弃P的同时也就意味着放弃了系统的可扩展性 |
| 放弃A | 一旦系统遇到网络分区或其他故障或为了保证一致性时，放弃可用性，那么受到影响的服务需要等待一定的时间，因此在等待期间系统**无法对外提供正常的服务**，即**不可用** |
| 放弃C | 这里所说的放弃一致性，实际上指的是放弃数据的**强一致性**，而保留数据的**最终一致性**。这样的系统无法保证数据保持实时的一致性，但是能够承诺的是，数据**最终会达到一个一致的状态**。 |



### BASE

既然CAP无法完美满足，在实际应用中需要做些折中处理。业界比较推崇的BASE理论

（`Basically Availabe`基本可用，`Soft state`软状态，`Eventually consistency`最终一致性）理论是对大规模的互联网分布式系统实践的总结，用弱一致性来换取可用性，不同于ACID，属于`AP`系统。

#### 基本可用(B)

基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性，可以通过降级方案，损失部分响应时间或者功能，来继续提供服务。

#### 软状态(AS)

软状态是指允许系统中的数据存在**中间状态**，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同的数据副本之间进行数据同步的过程**存在延时**。

#### 最终一致性(E)

最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，**最终能够达到一致的状态**

## 总结



