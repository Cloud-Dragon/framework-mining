



[TOC]

### 分布式环境中存在的问题

- 通信异常，节点之间网络出现异常无法正常访问
- 网络分区，一部分节点可以连通，另一部分不能，形成了不同的网络区域
- 三态，即成功、失败、超时
- 节点故障，分布式系统中某个节点宕机导致链路中的一环出现问题

## 分布式事务演进

### ACID原则

是事务的特点，具有强一致性，一般用于单机事务，比如数据库事务，ACID即

- `Atomicity`原子性
- `Consistency`一致性
- `Isolation`隔离性
- `Durability`持久性

#### 原子性(A)

#### 一致性(C)

#### 隔离性(I)

#### 持久性(D)

### CAP

所谓的CAP即

- `Consistency`一致性
- `Availability`可用性
- `Partition tolerance`分区容错性

#### 一致性(C)

为了提高可用性，通常会对数据进行备份，多个数据副本之间需保证数据一致，即为一致性。

#### 可用性(A)

可用性即持续提供服务的能力，当某些机器出现故障时，仍然能够对外提供服务。通常通过SLA(Service-Level Agreement,服务等级协议)来衡量。通常以服务**响应时间**以及**成功率**作为考察指标。

#### 分区容错性(P)

当部分节点因为网络等原因，导致部分节点被隔离，形成网络分区，这种情况发生会导致数据不一致出现一些不可控的影响，危害大于可用性和一致性带来的影响，因而需要保证分区容错。一个节点的话不会发生网络分区，但是会失去扩展性。

CAP理论提出，一个分布式系统不能同时满足这三个特性，只能同时满足其中两个

|  CAP  | 说明                                                         |
| :---: | :----------------------------------------------------------- |
| 放弃P | 将所有事务参与方放在同一个节点上，能够避免由于网络分区带来问题，同时也就意味着放弃了系统的可扩展性，放弃了分布式。 |
| 放弃A | 一致性要求越强，可用性就会越弱，因为需要等待所有数据副本都同步更新最新数据，响应时间更长，也更容器出现不可用的场景 |
| 放弃C | 可用性要求越强，意味着需要牺牲数据副本同步及时性，通过异步或大多数原则保证最终一致性 |

对于分布式系统，`P`是基本要求，如果没有`P`就不是分布式系统了，所以一般都是在满足`P`的情况下，在`C`和`A`之间寻求平衡。

### BASE

既然CAP无法完美满足，在实际应用中需要做些折中处理。业界比较推崇的BASE理论

- `Basically Availabe`基本可用
- `Soft state`软状态
- `Eventually consistency`最终一致性

BASE理论是对大规模的互联网分布式系统实践的总结，用最终一致性来换取可用性，属于`AP`系统。

#### 基本可用(BA)

基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性，可以通过降级方案，损失部分响应时间或者功能，来继续提供服务。

#### 软状态(S)

软状态是指允许系统中的数据存在**中间状态**，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同的数据副本之间进行数据同步的过程**存在延时**。

#### 最终一致性(E)

最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，**最终能够达到一致的状态**





